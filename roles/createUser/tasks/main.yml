---
- name: Prompts for the Create user role
  vars_prompt:
    - name: user_name
      prompt: "Enter the user name:"
      private: no
    - name: user_password
      prompt: "Enter the user password:"
      private: yes

- name: Create user role
  ansible.builtin.user:
    name: "{{ user_name }}"
    state: present
    password: "{{ user_password | password_hash('sha512') }}"
    create_home: true

  ansible.builtin.file:
    path: /etc/sudoers.d/{{ user_name }}
    state: touch
    owner: root
    group: root
    mode: 0440

  ansible.builtin.lineinfile:
    dest: /etc/sudoers.d/{{ user_name }}
    state: present
    line: '{{ user_name }} ALL=(ALL) NOPASSWD:ALL'
